<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        @font-face {
            font-family: "SleepToken";
            src: url("SleepToken_v111.ttf");
        }

        .glyphs {
            font-family: "SleepToken";
            font-size: 23px;
            /* Specify the unit for font size */
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            font-family: 'MS Gothic', sans-serif;
            /* Choose a fallback Japanese-style font */
            line-height: 1.5;
            /* Adjust line height for better readability */
            margin: 45px;
        }

        .grid td {
            padding-right: 75px;
            /* Adjust the spacing as needed */
        }

        #warning-message {
            color: red;
            font-weight: bold;
            display: none;
        }
    </style>
</head>

<body>
    <label for="textInput">Type something:</label>
    <textarea id="textInput" style="width: 300px; height: 100px;"></textarea>
    <div>
        <button onclick="writeText()">Write</button>
        <button onclick="toggleBold()">Toggle Bold</button>
        <button onclick="toggleTranslate()">Translate</button>
    </div>
    <div id="warning-message"></div><br><br>
    <div id="output"></div>
    <script>
        const GLYPHS_BOOL = true;
        let TRANSLATE_BOOL = false;
        let BOLD_BOOL = false;

        function isTextValid(text) {
            // Define the disallowed characters
            const disallowedChars = ['j', 'x', 'z'];

            // Find the disallowed characters present in the text
            const invalidChars = disallowedChars.filter(char => text.includes(char));

            // Check if any disallowed characters are present in the text
            return {
                isValid: invalidChars.length === 0,
                invalidChars: invalidChars.join(', ')
            };
        }

        function writeText() {
            // Get the value from the textarea
            text = document.getElementById("textInput").value;

            // Check if the text contains unallowed characters
            const validationResult = isTextValid(text);

            let warningMessage = document.getElementById('warning-message');
            warningMessage.style.display = 'none'; // Hide the warning message initially

            if (!validationResult.isValid) {
                warningMessage.textContent = `Warning: The following characters are not yet known to worshippers: { ${validationResult.invalidChars} }`;
                warningMessage.style.display = 'block';
            }

            // Clear previous content
            document.getElementById('output').innerHTML = '';

            const container = document.getElementById('output');

            const CHARS_PER_COLUMN = 25; // Set your desired number of characters per column
            const COLUMNS_PER_PAGE = 25; // Set your desired number of columns per page

            let characters = text.split('');

            // Here, we create an empty array called grid which will be used to represent the structure of our text in columns.
            let grid = [];

            // Initialize the grid with empty arrays for each column
            // In this loop, we populate the grid array with empty arrays to represent each column.
            // The loop runs COLUMNS_PER_PAGE times, creating an empty array for each column.
            for (let i = 0; i < COLUMNS_PER_PAGE; i++) {
                grid.push([]);
            }

            // Iterate through each character in the input text            
            let columnIndex = 0;
            let currentIndex = 0;
            characters.forEach(char => {
                if (char === ' ' && currentIndex >= CHARS_PER_COLUMN
                    || char === '\n') {
                    // Check if the character is a space or newline and the current index exceeds the limit
                    columnIndex = (columnIndex + 1) % COLUMNS_PER_PAGE;
                    currentIndex = 0;
                } else {
                    // Add the character to the current column in the grid
                    grid[columnIndex].push(char);
                    currentIndex++;
                }
            });

            // Create a table to represent the grid
            let table = document.createElement('table');
            table.classList.add('grid');

            if (BOLD_BOOL) {
                table.style.fontWeight = 'bold';
            }

            container.appendChild(table);

            // Populate the table with characters, adding some vertical spacing
            for (let i = 0; i < CHARS_PER_COLUMN * 2; i++) {
                let row = document.createElement('tr');
                table.appendChild(row);

                for (let j = 0; j < COLUMNS_PER_PAGE; j++) {
                    let cell = document.createElement('td');
                    if (GLYPHS_BOOL) {
                        cell.classList.add('character', 'glyphs');
                    } else {
                        cell.classList.add('character');
                    }
                    // ###################################
                    if (grid[j][i]) {
                        let character = grid[j][i];

                        let span = document.createElement('span');

                        if (TRANSLATE_BOOL && /^[a-zA-Z]$/.test(character)) {
                            // If translation is needed, create a span for the original character with default font
                            let originalSpan = document.createElement('span');
                            originalSpan.textContent = character;

                            // Append the original span to the cell
                            span.appendChild(originalSpan);

                            // Create a separate span for the translated part with a different font
                            let translationSpan = document.createElement('span');
                            translationSpan.textContent = ' = ' + character;
                            translationSpan.style.fontFamily = 'Courier New'; // Set your desired standard font
                            translationSpan.style.fontWeight = 'normal'; // Set the font weight to normal

                            // Append the translation span
                            span.appendChild(translationSpan);
                        } else {
                            // If no translation needed, create a single span with default font
                            span.textContent = character;
                        }

                        // Append the span to the cell
                        cell.appendChild(span);
                    } else {
                        cell.innerHTML = '&nbsp;'; // Non-breaking space for empty cells
                    }

                    // ##################################
                    row.appendChild(cell);
                }
            }
        }

        function toggleBold() {
            BOLD_BOOL = !BOLD_BOOL;
            writeText(); // Refresh the output to apply the bold style
        }

        function toggleTranslate() {
            TRANSLATE_BOOL = !TRANSLATE_BOOL;
            writeText(); // Refresh the output to apply the translation
        }
    </script>
</body>

</html>